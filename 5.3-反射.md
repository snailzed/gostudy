# 5.3 反射
> 在运行时动态获取一个变量的类型信息和值信息。使用`reflect`包解析。

## 1、获取变量类型
> 也可以使用类型断言(必须是接口类型才可以使用)

    t := reflect.TypeOf() //返回Type类型结构体
    t.Kind()    //返回
    
    //类型包含
    const (
     	Invalid Kind = iota
     	Bool
     	Int
     	Int8
     	Int16
     	Int32
     	Int64
     	Uint
     	Uint8
     	Uint16
     	Uint32
     	Uint64
     	Uintptr
     	Float32
     	Float64
     	Complex64
     	Complex128
     	Array
     	Chan
     	Func
     	Interface
     	Map
     	Ptr
     	Slice
     	String
     	Struct
     	UnsafePointer
     )


```go
package main

import (
	"fmt"
	"reflect"
)

func main() {
	//使用reflect.TypeOf 获取类型
	var a int = 1
	fmt.Println(reflect.TypeOf(a))

	//使用Kind()
	b := reflect.TypeOf(a).Kind()
	fmt.Println(b)
	switch b {
	case reflect.Int:
		fmt.Println("int")
	}
}

```
## 2、获取变量值
 
    v := reflect.ValueOf() //返回一个Value类型的结构体
    v.Type() //等价于 reflect.TypeOf() 
    v.Kind() //等价于 v.Type().Kind()
    v.Elem() //获取变量v的内存空间，如果是指针变量则需要调用该方法
    v.SetXXX() //设置变量的值，必须传入变量的地址，即指针，需先调用Elem()方法 ，只能设置可导出的字段   

```go
package main

import (
	"fmt"
	"reflect"
)

func main() {
	//使用reflect.TypeOf 获取类型
	var a int = 1
	//test_typeof(a)
	test_valueof(&a)
	fmt.Println(a)
}

func test_typeof(a interface{}) {
	//返回Type类型结构体
	fmt.Println(reflect.TypeOf(a))

	//使用Kind()
	b := reflect.TypeOf(a).Kind()
	fmt.Println(b)
	switch b {
	case reflect.Int:
		fmt.Println("int")
	}
}

func test_valueof(a interface{}) {
	//返回Value类型的结构体
	v := reflect.ValueOf(a)
	v.Type() //等价于 reflect.TypeOf()

	switch v.Kind() {
	case reflect.Int:
		v.SetInt(42)
		fmt.Println("int")
	case reflect.Float32:
		fmt.Println("Float32")
	case reflect.Ptr:
		v.Elem().SetInt(2423) //传入的是地址，必须先调用Elem()
		fmt.Println("Ptr")
	}
}
```

## 3、结构体反射
>1) 获取和设置结构体属性

   
   //反射获取，必须传入指针才能修改值
   TypeOf()
   Valueof()
   
   a := &Animal{}
   v := reflect.ValueOf(a)
   v.Elem().Field(0) //获取第0个属性的值
   v.Elem().Field(1)
   v.Elem().Field(2).SetString() //设置值
   
   
```go
package main

import (
	"fmt"
	"reflect"
)

type Animal struct {
	Name string "it is name"
	Age  int    "it is age"
	Desc string "it is desc"
}

func main() {
	a := new(Animal)
	v := reflect.ValueOf(a) //必须传入指针，才能修改值
	//Elem获取指向的内存空间，Field(index):设置指定的字段  SetXXX:只能设置可导出的字段
	v.Elem().Field(0).SetString("Snail")
	v.Elem().FieldByName("Age").SetInt(43)

	fmt.Println(v)
}

```


> 2) 获取和调用结构体方法


> 3) 获取结构体Tag